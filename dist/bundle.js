var Hooker={};!function(){"use strict";function e(e){var n=o(e);d&&(null==n||u?null==n&&u&&d(!1):d(!0)),u=null!=n}function n(e){}function t(e){var n=o(e);null!=n&&function(e){m.forEach(function(n){n.color&&n.color.equals(e)&&n.callback instanceof Function&&n.callback(p)})}(n)}function o(e){var n=function(e,n){var t=new THREE.Vector2(2*e.x-1,-2*e.y+1);return g.setFromCamera(t,s),g.intersectObject(n)}(function(e,n){return new THREE.Vector2(e/c.width,n/c.height)}(e.clientX,e.clientY),r);if(0==n.length)return null;var t=n[0].uv;r.material.map.transformUv(t);var o=t.x*a.width>>0,i=t.y*a.height>>0;p.point={x:n[0].point.x,y:n[0].point.y},p.texturePoint={x:o,y:i};var d=l.getImageData(o,i,1,1).data;return d[3]<10?null:new THREE.Color(d[0],d[1],d[2])}function i(){c.width=window.innerWidth,c.height=window.innerHeight}var a,r,s,d,l=a.getContext("2d"),c={},m=[],u=!1,g=new THREE.Raycaster,p={};Hooker.init=function(o,d,c){i(),document.addEventListener("mousemove",e,!1),document.addEventListener("mousedown",t,!1),document.addEventListener("mouseup",n,!1),window.addEventListener("resize",i,!1),s=o,r=d;var m=c||d.material.map;m.image instanceof HTMLCanvasElement?(a=m.image,l=a.getContext("2d")):function(e){a||(a=document.createElement("canvas")),l=a.getContext("2d"),a.width=e.image.width,a.height=e.image.height,l.clearRect(0,0,a.width,a.height),l.drawImage(e.image,0,0)}(m)},Hooker.release=function(){document.removeEventListener("mousemove",e,!1),document.removeEventListener("mousedown",t,!1),document.removeEventListener("mouseup",n,!1),window.removeEventListener("resize",i,!1)},Hooker.setColorMap=function(e){m=e},Hooker.setHowerCallback=function(e){d=e}}(),function(){"use strict";function e(){requestAnimationFrame(e),E.orbit(c.position,s.getElapsedTime()),d.update(r),l.update(),a.render(i,r)}var n,t=!0,o=new THREE.AmbientLight(16777215,.5);if(Detector.webgl){var i,a,r,s,d,l,c,m=document.getElementById("hud"),u=document.getElementById("container"),g=document.getElementById("loading-container"),p=document.getElementById("loading-message"),E={light:new THREE.DirectionalLight(16777215,1),speed:.1,distance:1e3,orbit:function(e,n){this.light.position.x=(e.x+this.distance)*Math.sin(n*-this.speed),this.light.position.z=(e.z+this.distance)*Math.cos(n*this.speed)}};window.addEventListener("load",function(){!function(e){function n(e,n){return function(t){l[n]=t,d++,"function"==typeof r&&r({path:e,name:n,total:s,completed:d}),d===s&&"function"==typeof a&&a({textures:l})}}var t,o=e.paths,i=e.onBegin,a=e.onComplete,r=e.onProgress,s=0,d=0,l={};for(t in o)o.hasOwnProperty(t)&&s++;i({total:s,completed:d});for(t in o)if(o.hasOwnProperty(t)){var c=o[t];"string"==typeof c?THREE.ImageUtils.loadTexture(c,null,n(c,t)):"object"==typeof c&&THREE.ImageUtils.loadTextureCube(c,null,n(c,t))}}({paths:{area:"img/maps/area.png",pony:"img/maps/pony.png",moon:"img/maps/moon.jpg",moonNormal:"img/maps/normal.jpg",starfield:["img/starfield/front.png","img/starfield/back.png","img/starfield/left.png","img/starfield/right.png","img/starfield/top.png","img/starfield/bottom.png"]},onBegin:function(){g.style.display="block"},onProgress:function(e){p.innerHTML=e.name},onComplete:function(t){g.style.display="none";var o=t.textures;c=function(e,n){var t=new THREE.SphereGeometry(100,50,50),o=new THREE.MeshPhongMaterial({map:e,normalMap:n,shininess:0}),a=new THREE.Mesh(t,o);return a.position.set(0,0,0),a.rotation.set(0,180,0),i.add(a),a}(o.moon,o.moonNormal),n=function(e){var n=new THREE.SphereGeometry(100.1,50,50),t=new THREE.MeshPhongMaterial({map:e,shininess:0,transparent:!0,opacity:.4}),o=new THREE.Mesh(n,t);return o.position.set(0,0,0),o.rotation.set(0,180,0),i.add(o),o}(o.pony),function(e){var n=THREE.ShaderLib.cube;n.uniforms.tCube.value=e;var t=new THREE.ShaderMaterial({fragmentShader:n.fragmentShader,vertexShader:n.vertexShader,uniforms:n.uniforms,depthWrite:!1,side:THREE.BackSide}),o=new THREE.CubeGeometry(15e3,15e3,15e3),a=new THREE.Mesh(o,t);return i.add(a),a}(o.starfield),Hooker.init(r,n,o.area),e()}}),function(){(a=new THREE.WebGLRenderer({antialias:!0,preserveDrawingBuffer:!0})).setClearColor(0,1),a.setSize(window.innerWidth,window.innerHeight),u.appendChild(a.domElement);var e=window.innerWidth/window.innerHeight;(r=new THREE.PerspectiveCamera(35,e,1,65536)).position.set(0,0,800),(i=new THREE.Scene).add(r),i.add(E.light),i.add(o),o.intensity=0,(d=new THREE.TrackballControls(r)).rotateSpeed=.5,d.dynamicDampingFactor=.5,(l=new Stats).domElement.style.position="absolute",l.domElement.style.bottom="0px",m.appendChild(l.domElement),s=new THREE.Clock,Hooker.setHowerCallback(function(e){n.material.opacity=e?.6:.4,a.domElement.style.cursor=e?"pointer":""}),Hooker.setColorMap([{color:new THREE.Color(255,4,16),callback:function(e){console.log("Clicked on red",e)}},{color:new THREE.Color(0,255,0),callback:function(e){console.log("Clicked on green",e)}},{color:new THREE.Color(0,0,255),callback:function(e){console.log("Clicked on blue",e)}}])}()},!1),window.addEventListener("resize",function(){a.setSize(window.innerWidth,window.innerHeight),r.aspect=window.innerWidth/window.innerHeight,r.updateProjectionMatrix()},!1),document.addEventListener("keydown",function(e){switch(e.keyCode){case"H".charCodeAt(0):m.style.display="none"===m.style.display?"block":"none";break;case"F".charCodeAt(0):screenfull.enabled&&screenfull.toggle();break;case"P".charCodeAt(0):window.open(a.domElement.toDataURL("image/png"));break;case"L".charCodeAt(0):(t=!t)?(E.light.intensity=1,o.intensity=0):(E.light.intensity=0,o.intensity=.8)}},!1)}else Detector.addGetWebGLMessage()}();