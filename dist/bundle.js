var Hooker={};!function(){"use strict";function e(e){var n=o(e);d&&(null==n||g?null==n&&g&&d(!1):d(!0)),g=null!=n}function n(e){}function t(e){var n=o(e);null!=n&&function(e){u.forEach(function(n){n.color&&n.color.equals(e)&&n.callback instanceof Function&&n.callback(h)})}(n)}function o(e){var n=function(e,n){var t=new THREE.Vector2(2*e.x-1,-2*e.y+1);return E.setFromCamera(t,l),E.intersectObject(n)}(function(e,n){return new THREE.Vector2(e/m.width,n/m.height)}(e.clientX,e.clientY),s);if(0==n.length)return null;var t=n[0].uv;s.material.map.transformUv(t);var o=t.x*a.image.width>>0,i=t.y*a.image.height>>0;h.point={x:n[0].point.x,y:n[0].point.y},h.texturePoint={x:o,y:i};var r=c.getImageData(o,i,1,1).data;return r[3]<10?null:new THREE.Color(r[0],r[1],r[2])}function i(){m.width=window.innerWidth,m.height=window.innerHeight}var a,r=document.createElement("canvas");document.body.appendChild(r);var s,l,d,c=r.getContext("2d"),m={},u=[],g=!1,E=new THREE.Raycaster,h={};Hooker.init=function(o,d){i(),document.addEventListener("mousemove",e,!1),document.addEventListener("mousedown",t,!1),document.addEventListener("mouseup",n,!1),window.addEventListener("resize",i,!1),l=o,s=d,a=d.material.map,d.material.map=new THREE.CanvasTexture(function(e){return r.width=e.image.width,r.height=e.image.height,c.clearRect(0,0,r.width,r.height),c.drawImage(e.image,0,0),r}(a)),console.log(d.material.map)},Hooker.release=function(){document.removeEventListener("mousemove",e,!1),document.removeEventListener("mousedown",t,!1),document.removeEventListener("mouseup",n,!1),window.removeEventListener("resize",i,!1)},Hooker.setColorMap=function(e){u=e},Hooker.setHowerCallback=function(e){d=e}}(),function(){"use strict";function e(){requestAnimationFrame(e),h.orbit(c.position,s.getElapsedTime()),l.update(r),d.update(),a.render(i,r)}var n,t=!0,o=new THREE.AmbientLight(16777215,.5);if(Detector.webgl){var i,a,r,s,l,d,c,m=document.getElementById("hud"),u=document.getElementById("container"),g=document.getElementById("loading-container"),E=document.getElementById("loading-message"),h={light:new THREE.DirectionalLight(16777215,1),speed:.1,distance:1e3,orbit:function(e,n){this.light.position.x=(e.x+this.distance)*Math.sin(n*-this.speed),this.light.position.z=(e.z+this.distance)*Math.cos(n*this.speed)}};window.addEventListener("load",function(){!function(e){function n(e,n){return function(t){d[n]=t,l++,"function"==typeof r&&r({path:e,name:n,total:s,completed:l}),l===s&&"function"==typeof a&&a({textures:d})}}var t,o=e.paths,i=e.onBegin,a=e.onComplete,r=e.onProgress,s=0,l=0,d={};for(t in o)o.hasOwnProperty(t)&&s++;i({total:s,completed:l});for(t in o)if(o.hasOwnProperty(t)){var c=o[t];"string"==typeof c?THREE.ImageUtils.loadTexture(c,null,n(c,t)):"object"==typeof c&&THREE.ImageUtils.loadTextureCube(c,null,n(c,t))}}({paths:{area:"img/maps/area.png",moon:"img/maps/moon.jpg",moonNormal:"img/maps/normal.jpg",starfield:["img/starfield/front.png","img/starfield/back.png","img/starfield/left.png","img/starfield/right.png","img/starfield/top.png","img/starfield/bottom.png"]},onBegin:function(){g.style.display="block"},onProgress:function(e){E.innerHTML=e.name},onComplete:function(t){g.style.display="none";var o=t.textures;c=function(e,n){var t=new THREE.SphereGeometry(100,50,50),o=new THREE.MeshPhongMaterial({map:e,normalMap:n,shininess:0}),a=new THREE.Mesh(t,o);return a.position.set(0,0,0),a.rotation.set(0,180,0),i.add(a),a}(o.moon,o.moonNormal),n=function(e){var n=new THREE.SphereGeometry(100.1,50,50),t=new THREE.MeshPhongMaterial({map:e,shininess:0,transparent:!0,opacity:.4}),o=new THREE.Mesh(n,t);return o.position.set(0,0,0),o.rotation.set(0,180,0),i.add(o),o}(o.area),function(e){var n=THREE.ShaderLib.cube;n.uniforms.tCube.value=e;var t=new THREE.ShaderMaterial({fragmentShader:n.fragmentShader,vertexShader:n.vertexShader,uniforms:n.uniforms,depthWrite:!1,side:THREE.BackSide}),o=new THREE.CubeGeometry(15e3,15e3,15e3),a=new THREE.Mesh(o,t);return i.add(a),a}(o.starfield),Hooker.init(r,n),e()}}),function(){(a=new THREE.WebGLRenderer({antialias:!0,preserveDrawingBuffer:!0})).setClearColor(0,1),a.setSize(window.innerWidth,window.innerHeight),u.appendChild(a.domElement);var e=window.innerWidth/window.innerHeight;(r=new THREE.PerspectiveCamera(35,e,1,65536)).position.set(0,0,800),(i=new THREE.Scene).add(r),i.add(h.light),i.add(o),o.intensity=0,(l=new THREE.TrackballControls(r)).rotateSpeed=.5,l.dynamicDampingFactor=.5,(d=new Stats).domElement.style.position="absolute",d.domElement.style.bottom="0px",m.appendChild(d.domElement),s=new THREE.Clock,Hooker.setHowerCallback(function(e){n.material.opacity=e?.6:.4,a.domElement.style.cursor=e?"pointer":""}),Hooker.setColorMap([{color:new THREE.Color(255,4,16),callback:function(e){console.log("Clicked on red",e)}},{color:new THREE.Color(0,255,0),callback:function(e){console.log("Clicked on green",e)}},{color:new THREE.Color(0,0,255),callback:function(e){console.log("Clicked on blue",e)}}])}()},!1),window.addEventListener("resize",function(){a.setSize(window.innerWidth,window.innerHeight),r.aspect=window.innerWidth/window.innerHeight,r.updateProjectionMatrix()},!1),document.addEventListener("keydown",function(e){switch(e.keyCode){case"H".charCodeAt(0):m.style.display="none"===m.style.display?"block":"none";break;case"F".charCodeAt(0):screenfull.enabled&&screenfull.toggle();break;case"P".charCodeAt(0):window.open(a.domElement.toDataURL("image/png"));break;case"L".charCodeAt(0):(t=!t)?(h.light.intensity=1,o.intensity=0):(h.light.intensity=0,o.intensity=.8)}},!1)}else Detector.addGetWebGLMessage()}();